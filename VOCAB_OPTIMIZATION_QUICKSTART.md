# ç”Ÿè¯æœ¬æ€§èƒ½ä¼˜åŒ– - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸ¯ ä¼˜åŒ–æ•ˆæœ

- âœ… é¦–æ¬¡åŠ è½½æ—¶é—´å‡å°‘60-70% (3-5ç§’ â†’ 1.5ç§’)
- âœ… statsæŸ¥è¯¢æ—¶é—´å‡å°‘90% (200ms â†’ 20ms)
- âœ… æ¶ˆé™¤ä¸å¿…è¦çš„APIè°ƒç”¨ (å‡å°‘80%)
- âœ… æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ– (å‡å°‘30-50%)

---

## ğŸ“¦ å·²å®Œæˆçš„æ›´æ”¹

### ä»£ç æ›´æ”¹
1. âœ… `src/app/vocab/page.tsx` - ä¿®å¤useEffectä¾èµ–ï¼Œå»¶è¿ŸåŠ è½½æ¨¡å‹
2. âœ… `src/app/api/vocab/dashboard/route.ts` - ä½¿ç”¨æ•°æ®åº“å‡½æ•°ä¼˜åŒ–statsæŸ¥è¯¢
3. âœ… `supabase/migrations/20251023120000_optimize_vocab_performance.sql` - æ•°æ®åº“ä¼˜åŒ–

### æ–°å¢æ–‡ä»¶
1. âœ… `scripts/test-vocab-performance.js` - æ€§èƒ½æµ‹è¯•è„šæœ¬
2. âœ… `docs/optimization/VOCAB_PERFORMANCE_OPTIMIZATION.md` - è¯¦ç»†æ–‡æ¡£

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤ï¼ˆ3åˆ†é’Ÿï¼‰

### æ­¥éª¤1: è¿è¡Œæ•°æ®åº“è¿ç§» âš¡

**é€‰é¡¹A: æœ¬åœ°/å¼€å‘ç¯å¢ƒ**
```bash
supabase migration up
```

**é€‰é¡¹B: ç”Ÿäº§ç¯å¢ƒï¼ˆSupabase Dashboardï¼‰**
1. ç™»å½• Supabase Dashboard
2. è¿›å…¥é¡¹ç›® â†’ SQL Editor
3. æ‰“å¼€æ–‡ä»¶ `supabase/migrations/20251023120000_optimize_vocab_performance.sql`
4. å¤åˆ¶å†…å®¹åˆ°SQL Editor
5. ç‚¹å‡» "Run" æ‰§è¡Œ

**éªŒè¯è¿ç§»æˆåŠŸ**:
```sql
-- åœ¨SQL Editorä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯
SELECT routine_name 
FROM information_schema.routines 
WHERE routine_name = 'get_vocab_stats';

-- åº”è¯¥è¿”å›: get_vocab_stats
```

### æ­¥éª¤2: éªŒè¯ä»£ç æ›´æ”¹ âœ“

ä»£ç æ›´æ”¹å·²è‡ªåŠ¨åº”ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤çš„æ›´æ”¹
git status

# æŸ¥çœ‹æ›´æ”¹å†…å®¹
git diff src/app/vocab/page.tsx
git diff src/app/api/vocab/dashboard/route.ts
```

### æ­¥éª¤3: æµ‹è¯•æ€§èƒ½ï¼ˆå¯é€‰ï¼‰ğŸ§ª

```bash
# åœ¨å¼€å‘ç¯å¢ƒè¿è¡Œæµ‹è¯•
npm run dev

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæ€§èƒ½æµ‹è¯•
node scripts/test-vocab-performance.js
```

å¦‚æœéœ€è¦æµ‹è¯•è®¤è¯APIï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
export TEST_AUTH_TOKEN="your_user_access_token"
node scripts/test-vocab-performance.js
```

### æ­¥éª¤4: éƒ¨ç½²åˆ°ç”Ÿäº§ ğŸŒ

```bash
# æäº¤æ›´æ”¹
git add .
git commit -m "feat: ä¼˜åŒ–ç”Ÿè¯æœ¬é¡µé¢åŠ è½½æ€§èƒ½"

# æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push origin main

# Vercelä¼šè‡ªåŠ¨éƒ¨ç½²
# æˆ–æ‰‹åŠ¨è§¦å‘éƒ¨ç½²ï¼švercel --prod
```

---

## ğŸ“Š é¢„æœŸæµ‹è¯•ç»“æœ

è¿è¡Œæ€§èƒ½æµ‹è¯•åï¼Œä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼çš„ç»“æœï¼š

```
====================================
  æµ‹è¯•ç»“æœæ±‡æ€»
====================================

æ€»ä½“å¹³å‡å“åº”æ—¶é—´: 120ms âœ…

âœ¨ ä¼˜ç§€ï¼æ€§èƒ½è¡¨ç°å“è¶Š

è¯¦ç»†ç»“æœ:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ åŸºç¡€æŸ¥è¯¢ï¼ˆ10æ¡è®°å½•ï¼‰          85ms
âœ“ ä¸­ç­‰æŸ¥è¯¢ï¼ˆ50æ¡è®°å½•ï¼‰          145ms
âœ“ å¸¦è¯­è¨€ç­›é€‰                     95ms
âœ“ å¸¦çŠ¶æ€ç­›é€‰                     102ms
âœ“ å¸¦è§£é‡Šç­›é€‰ï¼ˆæœ‰è§£é‡Šï¼‰           88ms
âœ“ ç»„åˆç­›é€‰                       110ms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

**æ€§èƒ½è¯„çº§æ ‡å‡†**:
- âœ¨ < 100ms: ä¼˜ç§€
- âœ… 100-200ms: è‰¯å¥½
- âš ï¸ 200-500ms: ä¸€èˆ¬
- âŒ > 500ms: éœ€è¦ä¼˜åŒ–

---

## ğŸ” éªŒè¯ä¼˜åŒ–ç”Ÿæ•ˆ

### 1. æµè§ˆå™¨å¼€å‘è€…å·¥å…·

1. æ‰“å¼€ç”Ÿè¯æœ¬é¡µé¢ (`/vocab`)
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° Network æ ‡ç­¾
4. åˆ·æ–°é¡µé¢
5. æ£€æŸ¥ `/api/vocab/dashboard` çš„å“åº”æ—¶é—´

**ä¼˜åŒ–å‰**: 500ms - 2000ms  
**ä¼˜åŒ–å**: < 200ms âœ…

### 2. æ£€æŸ¥APIè°ƒç”¨æ¬¡æ•°

åœ¨ Network æ ‡ç­¾ä¸­ï¼Œç­›é€‰ XHR/Fetch è¯·æ±‚ï¼š

**ä¼˜åŒ–å‰**ï¼ˆæ¯æ¬¡ç­›é€‰å˜åŒ–ï¼‰:
- âŒ `/api/vocab/dashboard`
- âŒ `/profiles` (ç”¨æˆ·èµ„æ–™)
- âŒ `/api/ai/models`
- âŒ `/api/ai/openrouter-models`

**ä¼˜åŒ–å**ï¼ˆæ¯æ¬¡ç­›é€‰å˜åŒ–ï¼‰:
- âœ… `/api/vocab/dashboard` (ä»…æ­¤ä¸€ä¸ª)

### 3. æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢

åœ¨Supabase Dashboard â†’ Logs â†’ Postgres Logsä¸­æŸ¥çœ‹ï¼š

**ä¼˜åŒ–å‰çš„statsæŸ¥è¯¢**:
```sql
SELECT lang, status, explanation 
FROM vocab_entries 
WHERE user_id = '...'
-- è¿”å›æ‰€æœ‰è®°å½•ï¼Œå¯èƒ½æ•°åƒæ¡
```

**ä¼˜åŒ–åçš„statsæŸ¥è¯¢**:
```sql
SELECT get_vocab_stats('user_id')
-- è¿”å›å•ä¸ªJSONå¯¹è±¡ï¼Œèšåˆç»“æœ
```

---

## âš ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1: è¿ç§»å¤±è´¥ - "function already exists"

**è§£å†³æ–¹æ¡ˆ**:
```sql
-- å…ˆåˆ é™¤æ—§å‡½æ•°
DROP FUNCTION IF EXISTS get_vocab_stats(UUID);

-- ç„¶åé‡æ–°è¿è¡Œè¿ç§»
```

### é—®é¢˜2: APIè¿”å›é”™è¯¯ "RPCå‡½æ•°è°ƒç”¨å¤±è´¥"

**åŸå› **: æ•°æ®åº“å‡½æ•°å°šæœªåˆ›å»º

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤è¿ç§»å·²æˆåŠŸè¿è¡Œ
2. éªŒè¯å‡½æ•°å­˜åœ¨ï¼ˆè§æ­¥éª¤1ï¼‰
3. APIæœ‰é™çº§é€»è¾‘ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨æ—§æ–¹æ³•ï¼ˆè™½ç„¶è¾ƒæ…¢ï¼‰

### é—®é¢˜3: ç´¢å¼•åˆ›å»ºå¤±è´¥

**å¯èƒ½åŸå› **: è¡¨ä¸­å·²æœ‰é‡åç´¢å¼•

**è§£å†³æ–¹æ¡ˆ**:
```sql
-- åˆ é™¤å†²çªçš„ç´¢å¼•
DROP INDEX IF EXISTS idx_vocab_entries_user_status_created;
DROP INDEX IF EXISTS idx_vocab_entries_user_lang_status;
DROP INDEX IF EXISTS idx_vocab_entries_user_srs_due;

-- é‡æ–°è¿è¡Œè¿ç§»
```

### é—®é¢˜4: æ€§èƒ½æµ‹è¯•å¤±è´¥ - "Request timeout"

**åŸå› **: æœ¬åœ°æœåŠ¡æœªå¯åŠ¨æˆ–ç«¯å£ä¸å¯¹

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
npm run dev

# æˆ–è®¾ç½®æ­£ç¡®çš„URL
export NEXT_PUBLIC_SITE_URL="http://localhost:3000"
node scripts/test-vocab-performance.js
```

---

## ğŸ“ˆ ç›‘æ§ä¼˜åŒ–æ•ˆæœ

### å¼€å‘ç¯å¢ƒ
```bash
# æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
# åº”è¯¥çœ‹åˆ°ï¼š
# "APIè¿”å›æ•°æ®: { entries: 10, pagination: {...}, stats: {...} }"
# ä¸åº”è¯¥çœ‹åˆ°å¤šæ¬¡ "è·å–ç”¨æˆ·èµ„æ–™" æˆ– "è·å–æ¨¡å‹åˆ—è¡¨"
```

### ç”Ÿäº§ç¯å¢ƒ

1. **Vercel Analytics**
   - æŸ¥çœ‹ TTFB (Time to First Byte)
   - æŸ¥çœ‹ LCP (Largest Contentful Paint)

2. **Supabase Metrics**
   - Database â†’ Performance
   - æŸ¥çœ‹æŸ¥è¯¢æ‰§è¡Œæ—¶é—´
   - æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨ç‡

3. **Real User Monitoring**
   - æ”¶é›†ç”¨æˆ·çš„å®é™…åŠ è½½æ—¶é—´
   - å¯¹æ¯”ä¼˜åŒ–å‰åçš„æ•°æ®

---

## ğŸ‰ ä¸‹ä¸€æ­¥

ä¼˜åŒ–å·²å®Œæˆï¼ç°åœ¨ä½ å¯ä»¥ï¼š

1. âœ… éªŒè¯ç”Ÿè¯æœ¬é¡µé¢åŠ è½½é€Ÿåº¦
2. âœ… ç›‘æ§APIå“åº”æ—¶é—´
3. âœ… æ”¶é›†ç”¨æˆ·åé¦ˆ
4. ğŸ“– é˜…è¯»è¯¦ç»†æ–‡æ¡£: `docs/optimization/VOCAB_PERFORMANCE_OPTIMIZATION.md`
5. ğŸ”„ è€ƒè™‘å®æ–½é•¿æœŸä¼˜åŒ–ï¼ˆè§æ–‡æ¡£ï¼‰

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£: `docs/optimization/VOCAB_PERFORMANCE_OPTIMIZATION.md`
2. æ£€æŸ¥ Supabase æ—¥å¿—
3. è¿è¡Œæ€§èƒ½æµ‹è¯•è„šæœ¬è·å–è¯Šæ–­ä¿¡æ¯
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

---

**ä¼˜åŒ–å®Œæˆæ—¥æœŸ**: 2025å¹´10æœˆ23æ—¥  
**é¢„è®¡å½±å“**: æ‰€æœ‰ä½¿ç”¨ç”Ÿè¯æœ¬åŠŸèƒ½çš„ç”¨æˆ·  
**é£é™©ç­‰çº§**: ä½ï¼ˆåŒ…å«é™çº§é€»è¾‘ï¼Œå‘åå…¼å®¹ï¼‰

