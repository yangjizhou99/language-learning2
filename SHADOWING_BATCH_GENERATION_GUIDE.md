# Shadowing 批量生成功能使用指南

## 功能概述

这个功能允许你通过管理主题和小主题来批量生成 Shadowing 练习文章。主要包含两个页面：

1. **主题管理页面** (`/admin/shadowing/themes`) - 管理大主题
2. **小主题批量生成页面** (`/admin/shadowing/subtopics-gen`) - 管理小主题并批量生成

## 使用流程

### 1. 创建大主题

1. 访问 `/admin/shadowing/themes`
2. 选择语言、等级、体裁
3. 点击"新建主题"
4. 填写主题标题和描述
5. 保存

### 2. 创建小主题

1. 访问 `/admin/shadowing/subtopics-gen`
2. 选择语言、等级、体裁、大主题
3. 点击"新建小主题"
4. 填写：
   - 小主题标题（必填）
   - 英文关键词（用于生成锚点）
   - 一句话说明（用于生成意图提示）
5. 保存

### 3. 批量生成

1. 在筛选器中设置好语言、等级、体裁、大主题
2. 选择要生成的小主题（可多选）
3. 配置生成参数：
   - Provider（Gemini/OpenAI/Claude）
   - Model
   - 温度（0-1）
   - 并发数（1-10）
4. 点击"开始生成"
5. 观察进度和日志

## 功能特点

### 主题管理
- 四维筛选：语言、等级、体裁、搜索
- 批量操作：归档、删除
- 导入导出：JSON 格式
- 统计信息：显示每个主题下的小主题数量

### 小主题管理
- 行内编辑：可直接在表格中修改关键词和说明
- 批量保存：修改后统一保存
- 实时筛选：支持按主题筛选和搜索
- 状态管理：显示修改状态

### 批量生成
- 并发控制：可设置并发数避免 API 限制
- 实时进度：显示完成进度、保存数量、错误数量
- 详细日志：显示每个小主题的生成状态
- 去重机制：自动跳过已生成的内容
- 错误处理：生成失败时继续处理其他项目

## 技术实现

### 数据库表
- `shadowing_themes` - 大主题表
- `shadowing_subtopics` - 小主题表
- `shadowing_drafts` - 生成的草稿（添加了 source 字段）

### API 接口
- `GET/POST /api/admin/shadowing/themes` - 主题 CRUD
- `POST /api/admin/shadowing/themes/bulk` - 主题批量操作
- `GET/POST /api/admin/shadowing/subtopics` - 小主题 CRUD
- `POST /api/admin/shadowing/subtopics/bulk` - 小主题批量操作
- `POST /api/admin/shadowing/generate-from-subtopics/stream` - 批量生成（SSE）

### 难度预设
系统会根据语言、等级、体裁自动设置：
- 句子数量范围
- 语域（casual/neutral/formal）
- 长度目标（词数/字数）
- 最大句子长度

## 注意事项

1. **权限要求**：需要管理员权限
2. **API 限制**：注意并发数设置，避免触发 API 限制
3. **数据备份**：建议定期导出主题数据
4. **生成质量**：英文关键词和一句话说明对生成质量很重要
5. **去重机制**：相同小主题不会重复生成

## 故障排除

### 生成失败
- 检查 API 配置和额度
- 降低并发数
- 查看详细错误日志

### 数据丢失
- 检查数据库连接
- 查看浏览器控制台错误
- 确认权限设置

### 性能问题
- 减少并发数
- 分批处理大量数据
- 检查数据库索引


