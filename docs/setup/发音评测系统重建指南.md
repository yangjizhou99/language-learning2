# AIå‘éŸ³çº æ­£ç³»ç»Ÿ - æ•°æ®åº“é‡å»ºæŒ‡å—

> **é‡è¦æç¤º**ï¼šæœ¬æ“ä½œä¼šåˆ é™¤æ‰€æœ‰æ—§çš„è¯„æµ‹æ•°æ®ï¼Œè¯·ç¡®è®¤åå†æ‰§è¡Œï¼

---

## ğŸ“‹ é‡å»ºåŸå› 

### ä¿®å¤çš„é—®é¢˜
1. âœ… **æ ¼å¼ç»Ÿä¸€**ï¼šæ‹¼éŸ³ç»Ÿä¸€ä¸ºå¸¦ç©ºæ ¼æ ¼å¼ï¼ˆ"guo 2"ï¼‰
2. âœ… **åºå·è§„æ•´**ï¼šunit_id ä»1å¼€å§‹è¿ç»­
3. âœ… **æ¸…ç†é‡å¤**ï¼šåˆ é™¤ "bao3" å’Œ "bao 3" çš„é‡å¤
4. âœ… **ç”Ÿæˆå…³è”**ï¼šè‡ªåŠ¨å¡«å…… sentence_units è¡¨
5. âœ… **ä½¿ç”¨è¿›åº¦è¡¨**ï¼šå¯ç”¨ user_sentence_progress

### æ–°å¢åŠŸèƒ½
- âœ… **ä¸¤é˜¶æ®µåŠ è½½**ï¼šå…ˆæ˜¾ç¤º25å¥ï¼Œç‚¹"æ›´å¤š"å¯ç”¨æ™ºèƒ½æ¨è
- âœ… **è¿›åº¦è¿½è¸ª**ï¼šuser_sentence_progress è®°å½•æœ€ä½³åˆ†æ•°å’Œå°è¯•æ¬¡æ•°
- âœ… **çœŸæ­£åˆ«å**ï¼šåªä¸º lvâ†”lÃ¼ ç­‰çœŸæ­£åˆ«ååˆ›å»ºæ˜ å°„

---

## ğŸš€ æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤1ï¼šå¤‡ä»½ç°æœ‰æ•°æ®ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ æƒ³ä¿ç•™æ—§å½•éŸ³ä½œä¸ºå‚è€ƒï¼š

```bash
# å¤‡ä»½è¯„æµ‹è®°å½•
PGPASSWORD=postgres pg_dump -h 127.0.0.1 -p 54340 -U postgres -d postgres \
  -t user_pron_attempts -t user_unit_stats \
  --data-only > backup_pronunciation_$(date +%Y%m%d).sql
```

### æ­¥éª¤2ï¼šåˆ é™¤æ—§è¡¨

åœ¨ Supabase Studio SQL Editor æˆ–å‘½ä»¤è¡Œæ‰§è¡Œï¼š

```sql
-- åˆ é™¤æ—§è¡¨ï¼ˆV2è¿ç§»ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œè¿™é‡Œä»…ä½œè¯´æ˜ï¼‰
DROP TABLE IF EXISTS public.user_sentence_progress CASCADE;
DROP TABLE IF EXISTS public.user_unit_stats CASCADE;
DROP TABLE IF EXISTS public.user_pron_attempts CASCADE;
DROP TABLE IF EXISTS public.sentence_units CASCADE;
DROP TABLE IF EXISTS public.pron_sentences CASCADE;
DROP TABLE IF EXISTS public.unit_alias CASCADE;
DROP TABLE IF EXISTS public.zh_pinyin_units CASCADE;
DROP TABLE IF EXISTS public.unit_catalog CASCADE;
```

### æ­¥éª¤3ï¼šè¿è¡ŒV2è¿ç§»

```bash
# æ–¹å¼1ï¼šä½¿ç”¨ Supabase CLI
supabase db push

# æ–¹å¼2ï¼šåœ¨ Supabase Dashboard SQL Editor ä¸­
# å¤åˆ¶ supabase/migrations/20251021000001_create_pronunciation_assessment_v2.sql çš„å†…å®¹
# ç²˜è´´å¹¶æ‰§è¡Œ
```

### æ­¥éª¤4ï¼šéªŒè¯æ•°æ®

```bash
# è¿è¡Œè¯Šæ–­è„šæœ¬
NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54341 \
SUPABASE_SERVICE_ROLE_KEY=ä½ çš„KEY \
node scripts/check-pronunciation-data.js
```

**æœŸæœ›ç»“æœ**ï¼š
```
âœ… unit_catalog (zh-CN): ~170 æ¡ï¼ˆåŸºç¡€æ‹¼éŸ³é›†åˆï¼‰
âœ… pron_sentences (zh-CN): 25 æ¡
âœ… sentence_units: ~100 æ¡å…³è”
âœ… æ‰€æœ‰ symbol éƒ½æ˜¯å¸¦ç©ºæ ¼æ ¼å¼ï¼ˆå¦‚ "guo 2"ï¼‰
```

### æ­¥éª¤5ï¼šæµ‹è¯•åŠŸèƒ½

1. **åˆ·æ–°é¡µé¢**
2. **éº¦å…‹é£è‡ªæ£€** â†’ é€šè¿‡
3. **æŸ¥çœ‹å¥å­åˆ—è¡¨** â†’ åº”æ˜¾ç¤ºå‰25å¥
4. **å½•åˆ¶1-2å¥** â†’ éªŒè¯åŠŸèƒ½æ­£å¸¸
5. **ç‚¹å‡»"ç»ƒä¹ æ›´å¤šå¥å­"** â†’ å¯ç”¨æ™ºèƒ½æ¨èï¼ˆå¦‚æœæœ‰sentence_unitsæ•°æ®ï¼‰

---

## ğŸ“Š V2 æ”¹è¿›å¯¹ç…§è¡¨

| é¡¹ç›® | æ—§ç‰ˆ | V2ç‰ˆæœ¬ |
|------|------|--------|
| **æ‹¼éŸ³æ ¼å¼** | æ··åˆï¼ˆguo2 + guo 2ï¼‰ | ç»Ÿä¸€ï¼ˆguo 2ï¼‰ âœ… |
| **unit_idåºå·** | ä¹±åºï¼ˆ1, 50, 2000...ï¼‰ | è¿ç»­ï¼ˆ1, 2, 3...ï¼‰ âœ… |
| **zh_pinyin_units** | æ— ç©ºæ ¼ï¼ˆguo2ï¼‰ | å¸¦ç©ºæ ¼ï¼ˆguo 2ï¼‰ âœ… |
| **unit_alias** | å¤§é‡æ— æ„ä¹‰æ˜ å°„ | ä»…çœŸæ­£åˆ«å âœ… |
| **sentence_units** | ç©º | è‡ªåŠ¨ç”Ÿæˆ âœ… |
| **user_sentence_progress** | æœªä½¿ç”¨ | å·²å¯ç”¨ âœ… |
| **UIåŠ è½½** | ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ | 25å¥â†’æ›´å¤š âœ… |

---

## ğŸ”§ æ–°å¢å­—æ®µè¯´æ˜

### user_sentence_progress è¡¨ç»“æ„

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| user_id | UUID | ç”¨æˆ·ID |
| sentence_id | BIGINT | å¥å­ID |
| status | TEXT | pending/completed |
| attempts_count | INT | å°è¯•æ¬¡æ•° |
| best_score | NUMERIC | æœ€ä½³åˆ†æ•° |
| latest_score | NUMERIC | æœ€æ–°åˆ†æ•° |
| first_attempt_at | TIMESTAMPTZ | é¦–æ¬¡å°è¯•æ—¶é—´ |
| last_attempt_at | TIMESTAMPTZ | æœ€åå°è¯•æ—¶é—´ |

### ç”¨é€”
- **å¿«é€ŸæŸ¥è¯¢**ï¼šå“ªäº›å¥å­å®Œæˆäº†ï¼Ÿ
- **è¿›åº¦è¿½è¸ª**ï¼šç”¨æˆ·å®Œæˆäº† X / 25 å¥
- **æœ€ä½³åˆ†æ•°**ï¼šæ˜¾ç¤ºå†å²æœ€é«˜åˆ†
- **ç»Ÿè®¡åˆ†æ**ï¼šå¹³å‡æ¯å¥å°è¯•å‡ æ¬¡ï¼Ÿ

---

## ğŸ¯ æ–°çš„ç”¨æˆ·æµç¨‹

### é˜¶æ®µ1ï¼šåŸºç¡€ç»ƒä¹ ï¼ˆå›ºå®š25å¥ï¼‰
```
è¿›å…¥é¡µé¢ â†’ è‡ªæ£€ â†’ æ˜¾ç¤º25å¥
    â†“
å½•åˆ¶å¥å­ï¼ˆä»»æ„é¡ºåºï¼‰
    â†“
å®Œæˆéƒ¨åˆ†æˆ–å…¨éƒ¨25å¥
```

### é˜¶æ®µ2ï¼šæ™ºèƒ½æ¨èï¼ˆSet Coverï¼‰
```
ç‚¹å‡»"ç»ƒä¹ æ›´å¤šå¥å­"
    â†“
ç³»ç»Ÿåˆ†æï¼šå“ªäº›éŸ³èŠ‚æ ·æœ¬<3ï¼Ÿ
    â†“
æ¨èå¥å­ï¼šä¼˜å…ˆè¦†ç›–è–„å¼±éŸ³èŠ‚
    â†“
ç»§ç»­å½•åˆ¶ï¼ˆæ™ºèƒ½ä¼˜åŒ–ï¼‰
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®ä¸¢å¤±
- **user_pron_attempts**ï¼šæ‰€æœ‰è¯„æµ‹è®°å½•å°†è¢«åˆ é™¤
- **user_unit_stats**ï¼šæ‰€æœ‰ç»Ÿè®¡æ•°æ®å°†è¢«åˆ é™¤
- **pronunciation-audio**ï¼šéŸ³é¢‘æ–‡ä»¶ä¼šä¿ç•™ï¼ˆä½†è®°å½•ä¸¢å¤±ï¼‰

### 2. ç”¨æˆ·å½±å“
- æ‰€æœ‰ç”¨æˆ·éœ€è¦é‡æ–°å½•éŸ³
- å†å²è¿›åº¦æ¸…é›¶
- å¦‚æœ‰å¤šç”¨æˆ·ï¼Œéœ€è¦æå‰é€šçŸ¥

### 3. ç”Ÿäº§ç¯å¢ƒ
- **ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥æ‰§è¡Œ**
- åº”è¯¥å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
- è€ƒè™‘æ•°æ®è¿ç§»è„šæœ¬

---

## ğŸ” è¿ç§»åéªŒè¯æ¸…å•

- [ ] unit_catalog æœ‰æ•°æ®ï¼ˆ~170æ¡ï¼‰
- [ ] æ‰€æœ‰ symbol éƒ½æ˜¯å¸¦ç©ºæ ¼æ ¼å¼
- [ ] zh_pinyin_units ä¸ unit_catalog å¯¹åº”
- [ ] pron_sentences æœ‰25å¥
- [ ] sentence_units æœ‰å…³è”æ•°æ®ï¼ˆ~100æ¡ï¼‰
- [ ] user_sentence_progress è¡¨å­˜åœ¨
- [ ] pronunciation-audio bucket å­˜åœ¨
- [ ] RLS ç­–ç•¥å·²åˆ›å»º

---

## ğŸ› å¦‚æœå‡ºç°é—®é¢˜

### é—®é¢˜1ï¼šè¿ç§»æ‰§è¡Œå¤±è´¥
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
supabase db reset --debug

# æˆ–æ‰‹åŠ¨åœ¨ SQL Editor é€æ®µæ‰§è¡Œ
```

### é—®é¢˜2ï¼šsentence_units ä»ä¸ºç©º
```
åŸå› ï¼šå¸¸ç”¨å­—æ˜ å°„å¯èƒ½ä¸å…¨
è§£å†³ï¼šè¿è¡Œè¡¥å……è„šæœ¬æˆ–æ‰‹åŠ¨æ·»åŠ æ˜ å°„
```

### é—®é¢˜3ï¼šå‰ç«¯æŠ¥é”™
```
åˆ·æ–°é¡µé¢ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜
æ£€æŸ¥ API æ˜¯å¦æ­£å¸¸è¿”å›æ•°æ®
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡å»ºè¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼š
1. è®°å½•é”™è¯¯ä¿¡æ¯
2. è¿è¡Œè¯Šæ–­è„šæœ¬
3. æä¾›è¾“å‡ºç»“æœ

---

**åˆ›å»ºæ—¥æœŸ**ï¼š2025-10-13  
**è¿ç§»ç‰ˆæœ¬**ï¼šV2 (20251021000001)

