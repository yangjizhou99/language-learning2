# 🔧 管理员权限问题解决指南

## 问题症状

在 `/admin/articles` 页面使用 AI 生成功能时出现 `失败：forbidden` 错误。

## 原因分析

这个错误通常由以下两个原因之一导致：

1. **用户权限不足**：当前用户在数据库中的 `role` 不是 `admin`
2. **数据库表缺失**：缺少 `article_drafts` 表或相关的权限策略

## 🚀 快速解决方案

### 步骤 1: 访问管理员设置页面

1. 在顶部导航栏点击 **🔧 管理员** 链接
2. 或直接访问：`/admin/setup`

### 步骤 2: 检查状态

页面会自动检查：

- ✅ 当前用户登录状态
- ✅ 用户角色权限（user vs admin）
- ✅ 数据库表结构完整性

### 步骤 3A: 如果显示数据库错误

如果看到 `❌ article_drafts 表不存在`：

1. 打开 **Supabase 控制台**
2. 进入 **SQL Editor**
3. 复制页面显示的 SQL 语句并执行
4. 刷新设置页面确认状态变为 `✅ 数据库表结构正常`

### 步骤 3B: 如果数据库正常但角色是 user

如果数据库正常但当前角色显示为 `user`：

1. 点击 **"设置为管理员"** 按钮
2. 等待显示 `✅ 成功设置为管理员！`
3. 现在可以使用 AI 生成功能了

## 🎯 验证解决方案

设置完成后：

1. 访问 `/admin/articles`
2. 选择 **AI 生成** 标签页
3. 填写参数并点击 **"生成草稿"**
4. 应该看到成功消息而不是 forbidden 错误

## 📋 常见问题

**Q: 为什么需要管理员权限？**
A: AI 生成功能会创建草稿内容，只有管理员可以审核和发布到正式题库，确保内容质量。

**Q: 设置管理员权限安全吗？**
A: 是的，这只是在你自己的数据库中设置权限，不会影响其他用户。

**Q: 如果还是不工作怎么办？**
A: 检查浏览器控制台的错误信息，确保环境变量（如 `DEEPSEEK_API_KEY`）已正确配置。

## 🔗 相关页面

- `/admin/setup` - 管理员设置
- `/admin/articles` - 题库管理（AI生成）
- `/admin/drafts` - 草稿箱（审核发布）

---

如果问题仍然存在，请检查浏览器开发者工具的 Network 和 Console 标签页，查看具体的错误信息。
