# 并发测试脚本使用说明

## 📋 测试脚本说明

### 1. `quick-test.js` - 快速测试
- **用途**: 快速验证并发功能
- **特点**: 使用模拟数据，测试速度快
- **适用场景**: 开发调试，快速验证

### 2. `real-test.js` - 真实测试
- **用途**: 使用真实音频URL测试
- **特点**: 更接近实际使用场景
- **适用场景**: 性能测试，真实环境验证

### 3. `test-concurrency.js` - 完整测试
- **用途**: 详细的并发测试报告
- **特点**: 包含详细的统计分析和推荐
- **适用场景**: 生产环境评估，性能优化

## 🚀 使用方法

### 方法1: 使用批处理脚本 (推荐)
```bash
# Windows
run-test.bat

# 然后选择测试类型 (1-3)
```

### 方法2: 直接运行
```bash
# 快速测试
node quick-test.js

# 真实测试
node real-test.js

# 完整测试
node test-concurrency.js
```

## 📊 测试配置

### 测试级别
- **轻度测试**: 3并发，6请求
- **中度测试**: 5并发，10请求
- **重度测试**: 8并发，16请求
- **极限测试**: 12并发，24请求

### 监控指标
- **成功率**: 成功请求 / 总请求
- **响应时间**: 平均响应时间
- **并发数**: 同时处理的请求数
- **系统负载**: 基于活跃任务和队列长度

## 🔧 配置修改

### 修改测试参数
编辑脚本文件中的 `tests` 数组：
```javascript
const tests = [
  { concurrent: 3, total: 6, name: '轻度测试' },
  { concurrent: 5, total: 10, name: '中度测试' },
  // 添加更多测试级别
];
```

### 修改API地址
```javascript
const API_URL = 'http://localhost:3001/api/admin/shadowing/merge-audio';
```

### 修改音频URL
```javascript
const REAL_AUDIO_URLS = [
  '你的音频URL1',
  '你的音频URL2',
  // 添加更多URL
];
```

## 📈 结果解读

### 成功标准
- **成功率 ≥ 95%**: 系统稳定
- **成功率 90-95%**: 系统良好
- **成功率 < 90%**: 需要优化

### 响应时间
- **< 1000ms**: 优秀
- **1000-3000ms**: 良好
- **> 3000ms**: 需要优化

### 推荐并发数
脚本会自动分析结果并推荐最佳并发数，基于：
- 成功率 ≥ 95%
- 响应时间最短
- 系统稳定性

## 🐛 故障排除

### 常见问题
1. **连接被拒绝**: 检查API服务是否运行
2. **认证失败**: 检查Authorization header
3. **音频URL无效**: 使用有效的Supabase URL

### 调试模式
在脚本中添加更多日志：
```javascript
console.log('请求详情:', { requestId, audioUrls, startTime });
```

## 📝 注意事项

1. **测试前确保**: API服务正在运行
2. **测试环境**: 建议在开发环境进行
3. **资源消耗**: 高并发测试会消耗大量系统资源
4. **数据清理**: 测试产生的临时文件会自动清理

## 🎯 测试目标

通过测试找到：
- **最大稳定并发数**: 系统能稳定处理的最大并发
- **性能瓶颈**: 响应时间开始显著增加的点
- **错误阈值**: 开始出现大量错误的并发数
- **推荐配置**: 生产环境的最佳并发设置
